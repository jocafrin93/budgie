<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Budget Calculator</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        /* CSS Variables for theming */
        :root {
            --bg-color: #f3f4f6;
            --surface-color: #ffffff;
            --text-color: #1f2937;
            --text-secondary: #6b7280;
            --border-color: #d1d5db;
            --primary-color: #3b82f6;
            --primary-hover: #2563eb;
            --danger-color: #ef4444;
            --success-color: #10b981;
        }

        [data-theme="dark"] {
            --bg-color: #111827;
            --surface-color: #1f2937;
            --text-color: #f9fafb;
            --text-secondary: #9ca3af;
            --border-color: #374151;
            --primary-color: #60a5fa;
            --primary-hover: #3b82f6;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
        }

        .header h1 {
            margin: 0;
            color: var(--primary-color);
            font-size: 2.5rem;
            font-weight: 700;
        }

        .header p {
            margin: 5px 0 0 0;
            color: var(--text-secondary);
        }

        .theme-toggle {
            background: var(--surface-color);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 10px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .container {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .container:hover {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            cursor: pointer;
            user-select: none;
        }

        .section-header h3 {
            margin: 0;
            display: flex;
            align-items: center;
            font-size: 1.25rem;
            color: var(--text-color);
        }

        .collapse-icon {
            transition: transform 0.3s ease;
            font-size: 14px;
            margin-right: 8px;
        }

        .collapsed .collapse-icon {
            transform: rotate(-90deg);
        }

        .section-content {
            max-height: 2000px;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .collapsed .section-content {
            max-height: 0;
        }

        input,
        select,
        button {
            padding: 12px 16px;
            margin: 6px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--surface-color);
            color: var(--text-color);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        button {
            background: var(--primary-color);
            color: white;
            border: 2px solid var(--primary-color);
            cursor: pointer;
            font-weight: 600;
        }

        button:hover {
            background: var(--primary-hover);
            border-color: var(--primary-hover);
            transform: translateY(-1px);
        }

        .btn-danger {
            background: var(--danger-color);
            border-color: var(--danger-color);
            padding: 6px 12px;
            font-size: 12px;
        }

        .expense-item,
        .account-item,
        .transaction-item {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            padding: 16px;
            margin: 8px 0;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .expense-item:hover,
        .account-item:hover,
        .transaction-item:hover {
            background: var(--bg-color);
            transform: translateX(4px);
        }

        .category-header {
            background: linear-gradient(135deg, var(--category-color, #3b82f6), var(--category-color, #3b82f6));
            color: white;
            padding: 16px;
            border-radius: 8px;
            font-weight: 600;
            margin-bottom: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .form-row {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }

        .form-row input,
        .form-row select {
            flex: 1;
            min-width: 150px;
        }

        .summary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
            color: white;
            padding: 24px;
            border-radius: 12px;
            text-align: center;
            font-size: 18px;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .summary-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .balance-positive {
            color: var(--success-color);
            font-weight: 600;
        }

        .balance-negative {
            color: var(--danger-color);
            font-weight: 600;
        }

        @media (max-width: 768px) {
            body {
                padding: 12px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .form-row {
                flex-direction: column;
            }

            .form-row input,
            .form-row select {
                min-width: 100%;
            }

            .container {
                padding: 16px;
            }
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-content {
            background: var(--surface-color);
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px 0 24px;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
        }

        .modal-header h3 {
            margin: 0;
            color: var(--text-color);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0;
            margin: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
        }

        .modal-close:hover {
            background: var(--border-color);
            color: var(--text-color);
        }

        .modal-body {
            padding: 0 24px 24px 24px;
        }
    </style>
</head>

<body>
    <div class="header">
        <div>
            <h1>Budgie</h1>
            <p>Professional budget planning made simple</p>
        </div>
        <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle">🌙</button>
    </div>
    <div class="container">
        <div class="section-header" onclick="toggleSection('income')">
            <h3><span class="collapse-icon">▼</span>Income Settings</h3>
            <small>Configure your bi-weekly take-home pay</small>
        </div>
        <div class="section-content" id="income-content">
            <div class="form-row">
                <label>Bi-weekly Take-home Pay: $</label>
                <input type="number" id="payAmount" value="2800" placeholder="Enter your pay">
            </div>
        </div>
    </div>
    <div class="container"> <!--Manage Categories-->
        <div class="section-header" onclick="toggleSection('categories')">
            <h3><span class="collapse-icon">▼</span>Categories</h3>
            <small>Organize your budget with custom categories</small>
        </div>
        <div class="section-content" id="categories-content">
            <div style="margin-bottom: 15px;">
                <button onclick="openCategoryModal()">+ Add Category</button>
            </div>

            <div id="categoriesList">
                <!-- Categories will appear here -->
            </div>
        </div>
    </div>
    <div class="container"><!-- Add Expense-->
        <div class="section-header" onclick="toggleSection('addExpense')">
            <h3><span class="collapse-icon">▼</span>Add Expense</h3>
            <small>Plan for irregular expenses</small>
        </div>
        <div class="section-content" id="addExpense-content">
            <div style="margin-bottom: 15px;">
                <button onclick="openExpenseModal()">+ Add Expense</button>
            </div>

            <div style="text-align: center; color: var(--text-secondary); font-style: italic;">
                Your planned expenses appear in the "Your Expenses" section below
            </div>
        </div>
    </div>
    <div class="container"><!--Your Expenses-->
        <div class="section-header" onclick="toggleSection('expenses')">
            <h3><span class="collapse-icon">▼</span>Your Expenses</h3>
            <small>Planned expenses grouped by category</small>
        </div>
        <div class="section-content" id="expenses-content">
            <div id="expensesList">
                <!-- Expenses will appear here -->
            </div>
        </div>
    </div>
    <div class="container"><!--Accounts-->
        <div class="section-header" onclick="toggleSection('accounts')">
            <h3><span class="collapse-icon">▼</span>Accounts</h3>
            <small>Track balances across your accounts</small>
        </div>
        <div class="section-content" id="accounts-content">
            <div id="accountsList">
                <!-- Accounts will appear here -->
            </div>
        </div>
    </div>
    <div class="container"><!--Add Transaction-->
        <div class="section-header" onclick="toggleSection('addTransaction')">
            <h3><span class="collapse-icon">▼</span>Add Transaction</h3>
            <small>Record your spending and transfers</small>
        </div>
        <div class="section-content" id="addTransaction-content">
            <div class="form-row">
                <input type="date" id="transactionDate" value="">
                <input type="text" id="transactionPayee" placeholder="Payee (e.g., Grocery Store)">
                <input type="number" id="transactionAmount" placeholder="Amount" step="0.01">
                <select id="transactionAccount">
                    <!-- Accounts will be populated by JavaScript -->
                </select>
                <select id="transactionCategory">
                    <!-- Categories will be populated by JavaScript -->
                </select>
                <button onclick="addTransaction()">Add Transaction</button>
            </div>
        </div>
    </div>
    <div class="container"><!--Recent Transactions-->
        <div class="section-header" onclick="toggleSection('transactions')">
            <h3><span class="collapse-icon">▼</span>Recent Transactions</h3>
            <small>Your latest spending activity</small>
        </div>
        <div class="section-content" id="transactions-content">
            <div id="transactionsList">
                <!-- Transactions will appear here -->
            </div>
        </div>
    </div>
    <div class="container summary">
        <div>Total Bi-weekly Allocation: $<span id="totalAllocation">0</span></div>
        <div>Remaining Income: $<span id="remainingIncome">2800</span></div>
    </div>

    <script>
        // Storage key for our app
        const STORAGE_KEY = 'my-budget-data';

        // Functions to save and load data
        function saveData() {
            const dataToSave = {
                expenses: expenses,
                currentPay: currentPay,
                categories: categories,
                accounts: accounts,
                transactions: transactions
            };

            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
                console.log('Data saved successfully');
            } catch (error) {
                console.error('Failed to save data:', error);
            }
        }

        function loadData() {
            try {
                const savedData = localStorage.getItem(STORAGE_KEY);
                if (savedData) {
                    const data = JSON.parse(savedData);
                    expenses = data.expenses || [];
                    currentPay = data.currentPay || 2800;
                    categories = data.categories || [  // ← ADD THESE LINES
                        { id: 1, name: 'Personal Care', color: '#9333ea' },
                        { id: 2, name: 'Pet Care', color: '#059669' },
                        { id: 3, name: 'Household', color: '#dc2626' }
                    ];
                    accounts = data.accounts || [
                        { id: 1, name: 'Main Checking', type: 'checking', balance: 3500 },
                        { id: 2, name: 'Savings', type: 'savings', balance: 8200 },
                        { id: 3, name: 'Credit Card', type: 'credit', balance: -450 }
                    ];
                    transactions = data.transactions || [];
                    console.log('Data loaded successfully');
                    return true;
                }
            } catch (error) {
                console.error('Failed to load data:', error);
            }
            return false;
        }

        // Our data storage (will be loaded from localStorage)
        let expenses = [];
        let currentPay = 2800;
        let categories = [
            { id: 1, name: 'Personal Care', color: '#9333ea' },
            { id: 2, name: 'Pet Care', color: '#059669' },
            { id: 3, name: 'Household', color: '#dc2626' }
        ];
        let accounts = [
            { id: 1, name: 'Main Checking', type: 'checking', balance: 3500 },
            { id: 2, name: 'Savings', type: 'savings', balance: 8200 },
            { id: 3, name: 'Credit Card', type: 'credit', balance: -450 }
        ];
        let transactions = [];

        // Update pay when input changes
        document.getElementById('payAmount').addEventListener('input', function () {
            currentPay = parseFloat(this.value) || 0;
            updateSummary();
            saveData();
        });

        // Calculate how much to save bi-weekly for each frequency
        function calculateBiweeklyAmount(amount, frequency) {
            switch (frequency) {
                case 'weekly': return amount * 2;
                case 'bi-weekly': return amount;
                case 'monthly': return amount * 12 / 26;
                case 'every-6-weeks': return amount * 8.67 / 26;
                case 'every-8-weeks': return amount * 6.5 / 26;
                default: return amount;
            }
        }

        // Update the expenses list display
        function updateExpensesList() {
            const container = document.getElementById('expensesList');
            container.innerHTML = '';

            // Group expenses by category
            categories.forEach(category => {
                const categoryExpenses = expenses.filter(expense => expense.categoryId === category.id);

                if (categoryExpenses.length > 0) {
                    // Create category header
                    const categoryDiv = document.createElement('div');
                    categoryDiv.style.marginBottom = '20px';

                    const categoryHeader = document.createElement('div');
                    categoryHeader.style.cssText = `
                background-color: ${category.color};
                color: white;
                padding: 10px;
                border-radius: 5px;
                font-weight: bold;
                margin-bottom: 10px;
            `;
                    categoryHeader.textContent = `${category.name} (${categoryExpenses.length} items)`;

                    categoryDiv.appendChild(categoryHeader);

                    // Add expenses for this category
                    categoryExpenses.forEach(expense => {
                        const expenseDiv = document.createElement('div');
                        expenseDiv.className = 'expense-item';
                        expenseDiv.style.marginLeft = '20px'; // Indent under category
                        expenseDiv.innerHTML = `
                    <div>
                        <strong>${expense.name}</strong><br>
                        $${expense.amount} ${expense.frequency}
                    </div>
                    <div>
                        $${expense.biweeklyAmount.toFixed(2)}/bi-weekly
                        <button onclick="deleteExpense(${expense.id})" style="margin-left: 10px; background-color: #cc0000;">Delete</button>
                    </div>
                `;
                        categoryDiv.appendChild(expenseDiv);
                    });

                    container.appendChild(categoryDiv);
                }
            });

            // Show message if no expenses
            if (expenses.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">No expenses yet. Add one above!</p>';
            }
        }

        // Delete an expense
        function deleteExpense(id) {
            expenses = expenses.filter(expense => expense.id !== id);
            updateExpensesList();
            updateSummary();
            saveData();
        }

        // Update the summary totals
        function updateSummary() {
            const total = expenses.reduce((sum, expense) => sum + expense.biweeklyAmount, 0);
            const remaining = currentPay - total;

            document.getElementById('totalAllocation').textContent = total.toFixed(2);
            document.getElementById('remainingIncome').textContent = remaining.toFixed(2);
        }

        // Also populate transaction category dropdown
        function populateTransactionCategoryDropdown() {
            const dropdown = document.getElementById('transactionCategory');
            dropdown.innerHTML = '';

            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = category.name;
                dropdown.appendChild(option);
            });
        }

        // Update the categories management list
        function updateCategoriesList() {
            const container = document.getElementById('categoriesList');
            console.log('container found:', container);

            if (!container) {
                return;
            }

            container.innerHTML = '';

            categories.forEach(category => {
                const div = document.createElement('div');
                div.style.cssText = `
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            margin: 8px 0;
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            border-left: 4px solid ${category.color};
        `;

                div.innerHTML = `
            <div>
                <strong style="color: var(--text-color);">${category.name}</strong>
                <span style="margin-left: 10px; padding: 4px 8px; background-color: ${category.color}; color: white; border-radius: 4px; font-size: 12px;">●</span>
            </div>
            <button onclick="deleteCategory(${category.id})" class="btn-danger">Delete</button>
        `;

                container.appendChild(div);
            });
        }

        // Delete a category
        function deleteCategory(categoryId) {
            if (categories.length <= 1) {
                alert('You must have at least one category!');
                return;
            }

            if (confirm('Delete this category? Expenses will be moved to the first category.')) {
                // Move expenses to first remaining category
                const remainingCategories = categories.filter(cat => cat.id !== categoryId);
                const firstCategoryId = remainingCategories[0].id;

                expenses.forEach(expense => {
                    if (expense.categoryId === categoryId) {
                        expense.categoryId = firstCategoryId;
                    }
                });

                categories = remainingCategories;

                updateCategoriesList();
                updateCategoryDropdown();
                updateExpensesList();
                saveData();
            }
        }

        // Update accounts display
        function updateAccountsList() {
            const container = document.getElementById('accountsList');
            container.innerHTML = '';

            accounts.forEach(account => {
                const div = document.createElement('div');
                div.className = 'expense-item'; // Reuse existing styling

                const balanceColor = account.balance >= 0 ? '#059669' : '#dc2626';

                div.innerHTML = `
            <div>
                <strong>${account.name}</strong><br>
                <small>${account.type}</small>
            </div>
            <div style="color: ${balanceColor}; font-weight: bold;">
                $${Math.abs(account.balance).toFixed(2)}
                ${account.type === 'credit' && account.balance < 0 ? ' owed' : ''}
            </div>
        `;
                container.appendChild(div);
            });
        }

        // Update account dropdown for transactions
        function updateAccountDropdown() {
            const dropdown = document.getElementById('transactionAccount');
            dropdown.innerHTML = '';

            accounts.forEach(account => {
                const option = document.createElement('option');
                option.value = account.id;
                option.textContent = account.name;
                dropdown.appendChild(option);
            });
        }

        // Set today's date as default
        function setDefaultDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('transactionDate').value = today;
        }

        // Add a new transaction
        function addTransaction() {
            const date = document.getElementById('transactionDate').value;
            const payee = document.getElementById('transactionPayee').value;
            const amount = parseFloat(document.getElementById('transactionAmount').value);
            const accountId = parseInt(document.getElementById('transactionAccount').value);
            const categoryId = parseInt(document.getElementById('transactionCategory').value);

            if (date && payee && amount && accountId && categoryId) {
                const transaction = {
                    id: Date.now(),
                    date: date,
                    payee: payee,
                    amount: amount,
                    accountId: accountId,
                    categoryId: categoryId
                };

                transactions.push(transaction);

                // Clear form
                document.getElementById('transactionPayee').value = '';
                document.getElementById('transactionAmount').value = '';

                updateTransactionsList();
                saveData();
            }
        }

        // Update transactions display
        function updateTransactionsList() {
            const container = document.getElementById('transactionsList');
            container.innerHTML = '';

            // Show last 10 transactions
            const recentTransactions = transactions.slice(-10).reverse();

            recentTransactions.forEach(transaction => {
                const account = accounts.find(acc => acc.id === transaction.accountId);
                const category = categories.find(cat => cat.id === transaction.categoryId);

                const div = document.createElement('div');
                div.className = 'expense-item';
                div.innerHTML = `
            <div>
                <strong>${transaction.payee}</strong><br>
                <small>${transaction.date} • ${account?.name} • ${category?.name}</small>
            </div>
            <div>
                $${transaction.amount.toFixed(2)}
                <button onclick="deleteTransaction(${transaction.id})" style="margin-left: 10px; background-color: #cc0000; padding: 2px 6px; font-size: 12px;">Delete</button>
            </div>
        `;
                container.appendChild(div);
            });

            if (transactions.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">No transactions yet.</p>';
            }
        }

        // Delete a transaction
        function deleteTransaction(id) {
            transactions = transactions.filter(transaction => transaction.id !== id);
            updateTransactionsList();
            saveData();
        }

        // Theme toggle functionality
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            const toggleButton = document.getElementById('themeToggle');

            document.documentElement.setAttribute('data-theme', newTheme);
            toggleButton.textContent = newTheme === 'dark' ? '☀️' : '🌙';

            // Save theme preference
            localStorage.setItem('theme-preference', newTheme);
        }

        // Initialize all sections as expanded on page load 
        function initializeSections() {
            const sections = ['categories', 'income', 'addExpense', 'expenses', 'accounts', 'addTransaction', 'transactions'];

            sections.forEach(sectionId => {
                const content = document.getElementById(sectionId + '-content');
                if (content) {
                    content.style.maxHeight = content.scrollHeight + 'px';
                }
            });

            // Only update these lists (not categories)
            updateAccountsList();
            updateExpensesList();
            updateTransactionsList();
        }

        // Toggle section collapse
        function toggleSection(sectionId) {
            const content = document.getElementById(sectionId + '-content');
            const header = content.previousElementSibling;
            const icon = header.querySelector('.collapse-icon');

            if (content.style.maxHeight === '0px' || content.style.maxHeight === '') {
                content.style.maxHeight = content.scrollHeight + 'px';
                icon.textContent = '▼';
                header.parentElement.classList.remove('collapsed');
            } else {
                content.style.maxHeight = '0px';
                icon.textContent = '▶';
                header.parentElement.classList.add('collapsed');
            }
        }

        // Load saved theme on page load
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme-preference') || 'light';
            const toggleButton = document.getElementById('themeToggle');

            document.documentElement.setAttribute('data-theme', savedTheme);
            toggleButton.textContent = savedTheme === 'dark' ? '☀️' : '🌙';
        }

        // Modal functionality
        function openModal(title, contentHtml) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = contentHtml;
            document.getElementById('modalOverlay').classList.add('show');

            // Prevent body scroll when modal is open
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('show');
            document.body.style.overflow = 'auto';
        }

        // Close modal when pressing Escape key
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });
        // Open category modal
        function openCategoryModal() {
            const modalContent = `
        <div class="form-row">
            <input type="text" id="modalCategoryName" placeholder="Category name" style="flex: 1;">
            <input type="color" id="modalCategoryColor" value="#3b82f6" style="width: 60px;">
        </div>
        <div style="margin-top: 20px; text-align: right;">
            <button onclick="closeModal()" style="background: var(--border-color); color: var(--text-color); margin-right: 10px;">Cancel</button>
            <button onclick="addCategoryFromModal()">Add Category</button>
        </div>
    `;

            openModal('Add New Category', modalContent);

            // Focus on the name input
            setTimeout(() => {
                document.getElementById('modalCategoryName').focus();
            }, 100);
        }

        // Add category from modal
        function addCategoryFromModal() {
            const name = document.getElementById('modalCategoryName').value;
            const color = document.getElementById('modalCategoryColor').value;

            if (name) {
                const newCategory = {
                    id: Date.now(),
                    name: name,
                    color: color
                };

                categories.push(newCategory);

                // Update all the displays
                updateCategoriesList();
                updateCategoryDropdown();
                populateTransactionCategoryDropdown();

                // Re-expand the categories section to show the updated list
                const categoriesContent = document.getElementById('categories-content');
                categoriesContent.style.maxHeight = categoriesContent.scrollHeight + 'px';

                saveData();
                closeModal();
            } else {
                alert('Please enter a category name');
            }
        }
        // Open expense modal
        function openExpenseModal() {
            const modalContent = `
        <div class="form-row">
            <input type="text" id="modalExpenseName" placeholder="Expense name (e.g., Hair cut)" style="flex: 1;">
            <input type="number" id="modalExpenseAmount" placeholder="Amount">
        </div>
        <div class="form-row">
            <select id="modalExpenseCategory" style="flex: 1;">
                ${categories.map(cat => `<option value="${cat.id}">${cat.name}</option>`).join('')}
            </select>
            <select id="modalExpenseFrequency" style="flex: 1;">
                <option value="weekly">Weekly</option>
                <option value="bi-weekly">Bi-weekly</option>
                <option value="monthly">Monthly</option>
                <option value="every-6-weeks">Every 6 weeks</option>
                <option value="every-8-weeks">Every 8 weeks</option>
            </select>
        </div>
        <div style="margin-top: 20px; text-align: right;">
            <button onclick="closeModal()" style="background: var(--border-color); color: var(--text-color); margin-right: 10px;">Cancel</button>
            <button onclick="addExpenseFromModal()">Add Expense</button>
        </div>
    `;

            openModal('Add New Expense', modalContent);

            // Focus on the name input
            setTimeout(() => {
                document.getElementById('modalExpenseName').focus();
            }, 100);
        }

        // Add expense from modal
        function addExpenseFromModal() {
            const name = document.getElementById('modalExpenseName').value;
            const amount = parseFloat(document.getElementById('modalExpenseAmount').value);
            const categoryId = parseInt(document.getElementById('modalExpenseCategory').value);
            const frequency = document.getElementById('modalExpenseFrequency').value;

            if (name && amount) {
                const expense = {
                    id: Date.now(),
                    name: name,
                    amount: amount,
                    frequency: frequency,
                    categoryId: categoryId,
                    biweeklyAmount: calculateBiweeklyAmount(amount, frequency)
                };

                expenses.push(expense);

                updateExpensesList();
                updateSummary();

                // Re-expand the expenses section to show the updated list
                const expensesContent = document.getElementById('expenses-content');
                expensesContent.style.maxHeight = expensesContent.scrollHeight + 'px';

                saveData();
                closeModal();
            } else {
                alert('Please enter both expense name and amount');
            }
        }
        // Load saved data when page starts
        if (loadData()) {
            document.getElementById('payAmount').value = currentPay;
            updateSummary();
        }

        // Initialize everything in the right order
        loadTheme();
        populateTransactionCategoryDropdown();
        updateAccountDropdown();
        setDefaultDate();

        // Update the categories list FIRST
        updateCategoriesList();

        // THEN initialize sections (so categories section knows its proper height)
        initializeSections();

        console.log("Budget calculator loaded!");


    </script>
    <!-- Modal Overlay -->
    <div id="modalOverlay" class="modal-overlay" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 id="modalTitle">Modal Title</h3>
                <button class="modal-close" onclick="closeModal()">✕</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Modal content will be inserted here -->
            </div>
        </div>
    </div>
</body>

</html>